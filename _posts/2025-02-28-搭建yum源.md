---
layout: post
title: "搭建yum源"
date:   2025-03-03
tags: [guide]
comments: true
author: xingsong
toc: true
---

问：Centos7 系统中为什么要搭建<span style="color: red;">自用</span>的yum和apt镜像源？

答：因为位于内网的CentOS服务器不能连接外网，因此在配置的时候存在各种麻烦，我们需要在服务器上安装一个docker以及各种开发工具，又由于docker的安装存在多种依赖，如果不能使用yum自动安装的话，自己逐个解决依赖会显得过于繁琐。所以最好的方法就是在内网上搭建一个yum源，不仅可以解决现在的问题，也可以方便后面内网其他设备进行部署。

<!-- more -->

# 概述

Yum是CentOS上负责打包和安装rpm包的工具（类似的有apt-get/homebrew等），它将所有的软件都存储在服务器上（一般称之为源），这些服务器的地址都以*.repo的文件形式存储在本地PC的/etc/yum.repos.d。每次使用指令 yum install **时，yum就会根据本地的repo文件找到服务器的地址，根据名称找到服务器上的软件进行打包下载。

所以我们要做的就是，在内网上使用一台服务器用来存储所有的软件，当作源；将需要使用Yum源的服务器中的*.repo文件中的ip地址指向源服务器。

# 依赖

Centos7 版本安装，需要如下软件：
~~~shell
----------------------------
# 提供web服务 (二选一) 本文使用Apache作为存储源
1.apache(httpd)  # 传统，适合小型 YUM 仓库，yum常用web容器首选
2.openresty
----------------------------
createrepo # 搭建yum仓库使用
repotrack # 下载安装包以及相关依赖
----------------------------
apt  # 为了支持ubuntu的repo
gpg # 生成密钥
dpkg-dev # 生成package信息
----------------------------
~~~

# 步骤
## 安装Apache

~~~shell
$ yum install httpd # 安装Apache，当然也可稍后安装
$ systemctl start httpd # 开启apache服务
$ systemctl status httpd # 查看Apache服务状态
~~~

当完成上述操作，访问一下 http://ip:80 如果出现403或者无法访问该网站，请检查防火墙：关闭防火墙或者放行对应端口。

防火墙操作如下:
~~~shell
$ systemctl stop firewalld.service # 此次关闭防火墙
$ systemctl disable firewalld.service # 关闭防火墙
$ systemctl enable httpd # 开机自启Apache服务
$ iptables -I INPUT -p TCP --dport 80 -j ACCEPT # 放行80端口	
~~~

可以 cd 进目录`/etc/httpd/conf/httpd.conf`中修改配置文件目录索引，也可以按照默认的`/var/www/html`来 （类似tomcat 中的webapp）如果修改了目录索引，记得重启Apache服务


